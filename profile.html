<!DOCTYPE html>
<html>
<head>
  <title>Edit Your Profile</title>
</head>
<body>
  <h2>Edit Profile</h2>
  <form id="profileForm">
    <textarea id="bio" placeholder="Your bio"></textarea><br>
    <input type="text" id="link" placeholder="Your link (https://...)"><br>
    <button type="submit">Save</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const vanity = urlParams.get("vanity");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        alert("You must be logged in.");
        window.location.href = "signup.html";
        return;
      }

      const docRef = doc(db, "vanities", vanity);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists() || docSnap.data().uid !== user.uid) {
        alert("This vanity doesn't belong to you.");
        return;
      }

      // Prefill bio and link
      const data = docSnap.data();
      document.getElementById("bio").value = data.bio || "";
      document.getElementById("link").value = data.link || "";

      document.getElementById("profileForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const newBio = document.getElementById("bio").value;
        const newLink = document.getElementById("link").value;

        await updateDoc(docRef, {
          bio: newBio,
          link: newLink
        });

        alert("Profile updated!");
      });
    });
  </script>
</body>
</html>
